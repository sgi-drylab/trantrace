webpackJsonp([7],{"9n/O":function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"missionListMain"}},[a("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[a("el-breadcrumb-item",[t._v("Assignment")])],1),t._v(" "),a("div",{staticClass:"addSearch clearfix"},[a("div",{attrs:{id:"searchCon"}},[a("el-form",{ref:"searchForm_raw",staticClass:"demo-form-inline",attrs:{inline:!0,model:t.searchForm_raw,rules:t.rules,"label-position":"left","label-width":"120px",size:"small"}},[a("el-form-item",{attrs:{label:"Project Name:"}},[a("el-input",{attrs:{placeholder:"enter project name"},model:{value:t.searchForm_raw.product_name,callback:function(e){t.$set(t.searchForm_raw,"product_name",e)},expression:"searchForm_raw.product_name"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"Keyword:"}},[a("el-input",{attrs:{placeholder:"enter keyword"},model:{value:t.searchForm_raw.key,callback:function(e){t.$set(t.searchForm_raw,"key",e)},expression:"searchForm_raw.key"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"Status:"}},[a("el-select",{attrs:{clearable:"",placeholder:"please select status"},model:{value:t.searchForm_raw.status,callback:function(e){t.$set(t.searchForm_raw,"status",e)},expression:"searchForm_raw.status"}},[a("el-option",{attrs:{label:"All",value:""}}),t._v(" "),a("el-option",{attrs:{label:"Unassigned",value:"Unassigned"}}),t._v(" "),a("el-option",{attrs:{label:"Untranslated",value:"Untranslated"}}),t._v(" "),a("el-option",{attrs:{label:"Unretranslated",value:"Unretranslated"}}),t._v(" "),a("el-option",{attrs:{label:"Unreviewed",value:"Unreviewed"}}),t._v(" "),a("el-option",{attrs:{label:"Qualified",value:"Qualified"}})],1)],1),t._v(" "),a("el-form-item",[a("el-button",{staticClass:"searchBtn",attrs:{type:"primary"},on:{click:t.onSearch}},[a("i",{staticClass:"el-icon-search"},[t._v("Search")])])],1)],1)],1)]),t._v(" "),a("div",{staticClass:"showTransList"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"allocationTable",staticStyle:{width:"100%"},attrs:{data:t.allocationListTable,"row-class-name":t.tableRowClassName},on:{"selection-change":t.handleSelectionChange,"sort-change":t.sortChange}},[a("el-table-column",{attrs:{type:"selection",width:"35",align:"center",selectable:t.checkboxT}}),t._v(" "),a("el-table-column",{attrs:{label:"Source",align:"center",type:"expand",width:"75"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("ol",{staticStyle:{"padding-left":"20px"}},t._l(JSON.parse(e.row.translate),function(e,s){return a("li",{key:s,staticStyle:{margin:"10px 0",padding:"5px 0","border-bottom":"1px dashed #ccc"}},[t._v(t._s(e))])}))]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"product",label:"Project Name",align:"center",sortable:"custom"}}),t._v(" "),a("el-table-column",{attrs:{prop:"key",label:"Keyword",align:"center",sortable:"custom","show-overflow-tooltip":""}}),t._v(" "),a("el-table-column",{attrs:{prop:"lang",label:"Language",align:"center",sortable:"custom"}}),t._v(" "),a("el-table-column",{attrs:{prop:"status",label:"Status",align:"center",sortable:"custom"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",[t._v(t._s(e.row.status))])]}}])}),t._v(" "),"Unassigned"===t.searchForm.status||""===t.searchForm.status?a("el-table-column",{key:"UnassignedKey",attrs:{label:"Translator",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return"Unassigned"===e.row.status?[a("el-select",{attrs:{id:"selectTranslator"+e.row.id,placeholder:"required"},on:{"visible-change":function(a){t.visibleSelect(e.row)}},model:{value:e.row.translate_users_name,callback:function(a){t.$set(e.row,"translate_users_name",a)},expression:"scope.row.translate_users_name"}},t._l(e.row.translators,function(t,e){return a("el-option",{key:e,attrs:{label:t.name,value:t.name}})}))]:void 0}}])}):t._e(),t._v(" "),"Unassigned"===t.searchForm.status||""===t.searchForm.status?a("el-table-column",{attrs:{label:"Operation",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return["Unassigned"===e.row.status?a("el-button",{attrs:{type:"text",size:"medium",title:"Assign"},on:{click:function(a){t.submit(e.row)}}},[t._v("Assign")]):t._e()]}}])}):t._e()],1),t._v(" "),a("div",{attrs:{id:"batchSelected"}},[t._v("\n      "+t._s(t.multipleSelection.length)+" "+t._s(t.multipleSelection.length>1?"entries":"entry")+" selected\n      "),a("el-button",{staticStyle:{color:"rgb(255, 208, 75)"},attrs:{type:"text"},on:{click:t.batchSubmitOpen}},[t._v("Bulk Allocation")])],1),t._v(" "),a("el-pagination",{attrs:{background:"","current-page":t.currentPage,"page-sizes":[10,20,50,100,200],"page-size":t.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:t.total},on:{"current-change":t.handleCurrentChange,"size-change":t.handleSizeChange}}),t._v(" "),a("el-dialog",{attrs:{title:"Assignment",visible:t.dialogVisible,width:"40%",top:"40vh"},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("div",{staticClass:"dialog_warning_text"},[a("i",{staticClass:"el-message__icon el-icon-warning"}),t._v(" "),a("span",[t._v("Batch assign these selected entries to translator.")])]),t._v(" "),a("el-form",{ref:"batchTranslatorForm",staticClass:"demo-ruleForm",attrs:{model:t.batchTranslatorForm,rules:t.rules},nativeOn:{submit:function(t){t.preventDefault()}}},[a("el-form-item",{attrs:{prop:"batch_translator_name",label:"Please select a translator:"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:""},model:{value:t.batchTranslatorForm.batch_translator_name,callback:function(e){t.$set(t.batchTranslatorForm,"batch_translator_name",e)},expression:"batchTranslatorForm.batch_translator_name"}},t._l(t.translators,function(t,e){return a("el-option",{key:e,attrs:{label:t.name,value:t.name}})}))],1)],1),t._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("Cancel")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:t.batchSubmit}},[t._v("Yes")])],1)],1)],1)],1)},staticRenderFns:[]}},Cqyr:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={mounted:function(){var t=this;this.searchForm.product_name=this.$route.query.name||"",new Promise(function(e,a){t.$http.post("/api/user/list").then(function(a){t.userList=a.data.data,e()})}).then(function(){t.$http.post("/api/translate/list",qs.stringify({product_id:t.$route.query.id||"",product_name:t.searchForm.product_name,key:t.searchForm.key,status:t.searchForm.status,page:t.currentPage,count:t.pageSize})).then(function(e){e.data.data.forEach(function(e){t.$set(e,"translate_users_name",""),t.$set(e,"translators",[])}),e.data.data.length>0&&e.data.data.forEach(function(e){JSON.parse(e.translate_users).forEach(function(a){t.userList.forEach(function(t){if(a===t.id)return e.translators.push(t),!1})})}),t.allocationListTable=e.data.data,t.total=e.data.total})})},data:function(){return t={product_id:this.$route.query.id||null,loading:!1,searchForm_raw:{product_name:this.$route.query.name||"",key:this.$route.query.key||"",status:this.$route.query.status||"Unassigned"},searchForm:{product_name:this.$route.query.name||"",key:this.$route.query.key||"",status:this.$route.query.status||"Unassigned"},sort:[],userList:[],rules:{},translators:[],allocationListTable:[],total:0,multipleSelection:[],currentPage:Number(this.$route.query.page)||1,pageSize:Number(this.$route.query.count)||10,selectRowIndex:[],dialogVisible:!1,batchTranslatorForm:{batch_translator_name:""}},a={batch_translator_name:[{required:!0,message:"Please select a translator."}]},(e="rules")in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t;var t,e,a},watch:{multipleSelection:{handler:function(t){var e=this;this.selectRowIndex=[],t.length>0&&t.forEach(function(t,a){e.selectRowIndex.push(e.allocationListTable.indexOf(t)),e.tableRowClassName({item:t})})},deep:!0}},methods:{tableRowClassName:function(t){t.row;var e=t.rowIndex;if(this.selectRowIndex.includes(e))return"success-row"},onSearch:function(){var t=this;this.$refs.allocationTable.clearSort(),this.sort=[],this.currentPage=1,this.product_id=null,this.searchForm.product_name=this.searchForm_raw.product_name,this.searchForm.key=this.searchForm_raw.key,this.searchForm.status=this.searchForm_raw.status,this.$http.post("/api/translate/list",qs.stringify({product_id:"",product_name:this.searchForm.product_name,key:this.searchForm.key,status:this.searchForm.status,page:this.currentPage,count:this.pageSize})).then(function(e){e.data.data.forEach(function(e){t.$set(e,"translate_users_name",""),t.$set(e,"translators",[])}),e.data.data.length>0&&e.data.data.forEach(function(e){JSON.parse(e.translate_users).forEach(function(a){t.userList.forEach(function(t){if(a===t.id)return e.translators.push(t),!1})})}),t.allocationListTable=e.data.data,t.total=e.data.total})},sortChange:function(t){var e=this,a="";"ascending"===t.order&&(a="ASC"),"descending"===t.order&&(a="DESC"),this.sort[0]=t.prop,this.sort[1]=a,this.currentPage=1,this.$http.post("/api/translate/list",qs.stringify(t.prop?{product_id:this.$route.query.id||"",product_name:this.searchForm.product_name,key:this.searchForm.key,status:this.searchForm.status,page:this.currentPage,count:this.pageSize,sort:this.sort}:{product_id:this.$route.query.id||"",product_name:this.searchForm.product_name,key:this.searchForm.key,status:this.searchForm.status,page:this.currentPage,count:this.pageSize})).then(function(t){t.data.data.forEach(function(t){e.$set(t,"translate_users_name",""),e.$set(t,"translators",[])}),t.data.data.length>0&&t.data.data.forEach(function(t){JSON.parse(t.translate_users).forEach(function(a){e.userList.forEach(function(e){if(a===e.id)return t.translators.push(e),!1})})}),e.allocationListTable=t.data.data,e.total=t.data.total})},visibleSelect:function(t){document.getElementById("selectTranslator"+t.id).style.border="1px solid #DCDFE6"},submit:function(t){var e=this;if(t.translate_users_name){document.getElementById("selectTranslator"+t.id).style.border="1px solid #DCDFE6";var a={};a.translate_in_id=JSON.stringify([t.id]),a.translate_users_name=t.translate_users_name,this.$http.post("/api/translate/assign",qs.stringify(a)).then(function(t){setTimeout(function(){e.$store.state.taskList.Unassigned_nums-=1,e.handleCurrentChange(e.currentPage)},1e3)})}else document.getElementById("selectTranslator"+t.id).style.border="1px solid #E6A23C",this.$message({message:"Translator is required.",type:"warning"})},batchSubmitOpen:function(){var t=this;if(0===this.multipleSelection.length)return this.$message({message:"No entries are selected for bulk allocation.",type:"warning"}),!1;var e=!1,a=this.multipleSelection[0].product;this.multipleSelection.forEach(function(s){if(s.product!==a)return e=!0,t.$message({message:"Batch allocation only works for entries from same project.",type:"warning"}),!1}),e||(this.translators=this.multipleSelection[0].translators,this.dialogVisible=!0)},batchSubmit:function(){var t=this;this.$refs.batchTranslatorForm.validate(function(e){if(e){var a=[];$.each(t.multipleSelection,function(t,e){a.push(e.id)});var s={};s.translate_in_id=JSON.stringify(a),s.translate_users_name=t.batchTranslatorForm.batch_translator_name,t.$http.post("/api/translate/assign",qs.stringify(s)).then(function(e){setTimeout(function(){t.$store.state.taskList.Unassigned_nums-=a.length,t.batchTranslatorForm.batch_translator_name="",t.dialogVisible=!1,t.handleCurrentChange(t.currentPage)},1e3)})}})},checkboxT:function(t,e){return"Unassigned"===t.status},handleSelectionChange:function(t){this.multipleSelection=t},handleSizeChange:function(t){this.pageSize=t,this.currentPage=1,this.handleCurrentChange(this.currentPage)},handleCurrentChange:function(t){var e=this;this.currentPage=t,this.$http.post("/api/translate/list",qs.stringify(this.sort[0]?{product_id:this.$route.query.id||"",product_name:this.searchForm.product_name,key:this.searchForm.key,status:this.searchForm.status,page:this.currentPage,count:this.pageSize,sort:this.sort}:{product_id:this.$route.query.id||"",product_name:this.searchForm.product_name,key:this.searchForm.key,status:this.searchForm.status,page:this.currentPage,count:this.pageSize})).then(function(t){t.data.data.forEach(function(t){e.$set(t,"translate_users_name",""),e.$set(t,"translators",[])}),t.data.data.length>0&&t.data.data.forEach(function(t){JSON.parse(t.translate_users).forEach(function(a){e.userList.forEach(function(e){if(a===e.id)return t.translators.push(e),!1})})}),e.allocationListTable=t.data.data,e.total=t.data.total}).catch(function(t){throw t})}}}},MHEw:function(t,e,a){var s=a("VU/8")(a("Cqyr"),a("9n/O"),!1,function(t){a("V/Qy")},"data-v-476086cb",null);t.exports=s.exports},"V/Qy":function(t,e,a){var s=a("viVj");"string"==typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);a("rjj0")("8b24421e",s,!0,{})},viVj:function(t,e,a){(t.exports=a("FZ+f")(!1)).push([t.i,"",""])}});